<!DOCTYPE html> 
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz Analizador de Espectro</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --primary: #3b82f6;
  --primary-dark: #1e40af;
  --success: #10b981;
  --warning: #facc15;
  --error: #ef4444;
  --bg: #f3f4f6;
  --card: #ffffff;
  --text: #1f2937;
  --muted: #6b7280;
  --gradient: linear-gradient(135deg, #3b82f6, #1e40af);
}

body {
  margin:0;
  font-family:'Roboto', sans-serif;
  background:var(--bg);
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  padding:20px;
}

.quiz-container {
  background: var(--card);
  border-radius:20px;
  padding:40px;
  max-width:950px;
  width:100%;
  box-shadow:0 12px 40px rgba(0,0,0,0.15);
  animation: fadeIn 0.6s ease-in-out;
}

@keyframes fadeIn { from {opacity:0; transform:translateY(20px);} to {opacity:1; transform:translateY(0);} }

h1,h2 { font-family: 'Poppins', sans-serif; text-align:center; margin-bottom:25px; font-weight:700; }
h1 { background: var(--gradient); -webkit-background-clip:text; -webkit-text-fill-color:transparent; font-size:2.4em;}
h2 { font-size:2em; }

#role-screen, #start-screen, #quiz-screen, #results, #professor-screen, #professor-panel { display:none; }
#role-screen.active, #start-screen.active, #quiz-screen.active, #results.active, #professor-screen.active, #professor-panel.active { display:block; }

.input-emoji { display:flex; align-items:center; margin:10px 0; }
.input-emoji span { margin-right:8px; }

input, select { width:100%; padding:14px; border-radius:10px; border:1px solid #d1d5db; font-size:1em;}

button { background: var(--gradient); color:white; font-weight:600; border:none; border-radius:12px; padding:14px 28px; margin-top:15px; cursor:pointer; transition: transform 0.25s ease, box-shadow 0.25s ease; font-size:1em;}
button:hover { transform:translateY(-3px); box-shadow:0 6px 14px rgba(59,130,246,0.4);}

.progress-bar { background:#e5e7eb; border-radius:10px; overflow:hidden; margin-bottom:20px; height:14px;}
.progress { background: var(--gradient); height:100%; width:0; transition: width 0.4s ease;}
.quiz-status { display:flex; justify-content:space-between; margin-bottom:15px; font-weight:600; color:var(--muted);}

.question-box { padding:25px; border-radius:16px; background:#f9fafb; font-weight:600; margin-bottom:20px; font-size:1.2em; box-shadow: inset 0 2px 6px rgba(0,0,0,0.05); font-family:'Roboto', sans-serif; }

.options-list { list-style:none; padding:0;}
.options-list li { background:#f3f4f6; color:#1f2937; margin:10px 0; padding:16px; border-radius:10px; cursor:pointer; transition: background 0.3s, transform 0.2s, box-shadow 0.3s, border 0.2s; border:1px solid #d1d5db; font-size:1.1em; font-family:'Roboto', sans-serif; }
.options-list li:hover { background:#e0e7ff; transform:translateX(4px); box-shadow:0 4px 10px rgba(59,130,246,0.2);}
.options-list li.selected { border:2px solid #1e40af; box-shadow:0 4px 12px rgba(59,130,246,0.4); background: var(--primary); color:white; font-weight:600;}

.user-justification-container { margin-top:20px; }
.user-justification-container textarea { width:100%; padding:14px; border-radius:10px; border:1px solid #d1d5db; resize:none; margin-top:8px; min-height:80px;}
.word-count { text-align:right; font-size:0.85em; color:var(--muted);}

.result-item { padding:18px; border-radius:12px; margin-bottom:14px; border-left:5px solid transparent; opacity:0; transform:translateY(10px); animation: fadeInResult 0.5s forwards; font-family:'Roboto', sans-serif; }
@keyframes fadeInResult { to {opacity:1; transform:translateY(0);} }

.result-item.correct { border-left-color:#10b981; background:#d1fae5; }
.result-item.partial { border-left-color:#facc15; background:#fef3c7; }
.result-item.incorrect { border-left-color:#ef4444; background:#fee2e2;}

.score-display { font-size:1.4em; font-weight:700; margin-bottom:15px; color: var(--primary-dark);}

.warning-box { background:#e0f2ff; border-left:6px solid #3b82f6; color:#1f2937; padding:14px 18px; border-radius:12px; margin-top:15px; font-size:1em; font-weight:600; display:flex; flex-direction:column; gap:6px;}

.role-buttons { display:flex; justify-content:center; gap:20px; margin-top:30px; }
.role-buttons button { flex:1; font-size:1.2em; padding:20px; }
.table-container { margin-top:20px; overflow-x:auto; }
table { width:100%; border-collapse:collapse; margin-top:10px; }
th,td { border:1px solid #ddd; padding:10px; text-align:center; }
th { background:var(--primary); color:white; }
</style>
</head>
<body>
<div class="quiz-container">
<h1>üì° Quiz: Analizador de Espectro</h1>

<!-- Selecci√≥n de rol -->
<div id="role-screen" class="active">
  <h2>Selecciona tu rol</h2>
  <div class="role-buttons">
    <button id="btn-student">üë®‚Äçüéì Estudiante</button>
    <button id="btn-professor">üë®‚Äçüè´ Profesor</button>
  </div>
</div>

<!-- Pantalla Estudiante -->
<div id="start-screen">
<p>Bienvenido/a al Examen. Ingresa tus datos para comenzar:</p>
<div class="input-emoji"><span>üë§</span><input type="text" id="user-name" placeholder="Nombre"></div>
<div class="input-emoji"><span>üßë‚Äçüíº</span><input type="text" id="user-lastname" placeholder="Apellido"></div>
<div class="input-emoji"><span>üÜî</span><input type="text" id="user-cedula" placeholder="N√∫mero de C√©dula"></div>
<div class="input-emoji"><span>üè´</span>
<select id="user-school">
<option value="">Selecciona Escuela</option>
<option value="El√©ctrica">El√©ctrica ‚ö°</option>
<option value="Telecomunicaciones">Telecomunicaciones üì°</option>
</select>
</div>

<button id="start-quiz-btn">üöÄ Iniciar Quiz</button>

<div class="warning-box">
<p><strong>ADVERTENCIA</strong></p>
<p>1) Si cambias de pesta√±a o minimizas, el examen termina autom√°ticamente.</p>
<p>2) Una vez dado al bot√≥n ‚ÄúSiguiente‚Äù, no puedes retroceder a preguntas anteriores.</p>
<p>3) Solo se permite un intento.</p>
<p>4) Aseg√∫rate de responder y justificar cada pregunta; las puntuaciones dependen de la justificaci√≥n.</p>
<p>5) El tiempo total del examen es de 30 minutos.</p>
<p>6) Evita actualizar la p√°gina para no perder tu progreso.</p>
</div>
</div>

<!-- Pantalla Profesor -->
<div id="professor-screen">
  <p>Acceso de Profesor</p>
  <div class="input-emoji"><span>üÜî</span><input type="text" id="prof-cedula" placeholder="C√©dula"></div>
  <div class="input-emoji"><span>üîë</span><input type="password" id="prof-clave" placeholder="Clave de acceso"></div>
  <button id="login-professor-btn">Ingresar</button>
</div>

<!-- Panel Profesor -->
<div id="professor-panel">
  <h2>üìä Notas de Estudiantes</h2>
  <div class="table-container">
    <table id="grades-table">
      <thead>
        <tr>
          <th>Nombre</th><th>Apellido</th><th>C√©dula</th><th>Escuela</th><th>Nota</th><th>Acciones</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<!-- Quiz -->
<div id="quiz-screen">
<div class="progress-bar"><div class="progress"></div></div>
<div class="quiz-status"><span id="question-counter"></span> <span id="timer">Tiempo: 00:00</span></div>
<div id="quiz-content"></div>
<button id="next-btn">‚û°Ô∏è Siguiente</button>
</div>

<!-- Resultados -->
<div id="results">
<h2><span>üìä</span> Resultados</h2>
<div class="score-display"></div>
<div id="results-details"></div>
</div>

<script>
// Constantes
const PROFESOR_CLAVE = "prueba";

// Datos del quiz
const allQuizData=[
  {
    question:"¬øCu√°l ser√≠a la consecuencia de utilizar un ancho de banda de resoluci√≥n (RBW) demasiado amplio en una medici√≥n?",
    options:[
      "Se mejora la capacidad de separar se√±ales muy cercanas.",
      "El nivel de ruido disminuye y la resoluci√≥n mejora.",
      "Se pierde la capacidad de distinguir se√±ales pr√≥ximas en frecuencia.",
      "No tiene ning√∫n efecto sobre la medici√≥n."
    ],
    correctAnswer:"Se pierde la capacidad de distinguir se√±ales pr√≥ximas en frecuencia.",
    keywords:["RBW","ancho de banda","se√±ales cercanas","resoluci√≥n"]
  },
  {
    question:"Si al variar el atenuador de RF la distorsi√≥n no cambia, ¬øqu√© conclusi√≥n podemos sacar?",
    options:[
      "La distorsi√≥n es originada por el propio analizador.",
      "La distorsi√≥n proviene de la se√±al original.",
      "El nivel de ruido est√° fuera de especificaciones.",
      "El oscilador local est√° generando arm√≥nicos."
    ],
    correctAnswer:"La distorsi√≥n proviene de la se√±al original.",
    keywords:["atenuador","distorsi√≥n","se√±al original"]
  },
  {
    question:"El oscilador local en un analizador de espectro superheterodino permite:",
    options:[
      "Generar la escala en frecuencia para la pantalla.",
      "Mezclar la se√±al de entrada para llevarla a una frecuencia intermedia (IF) fija.",
      "Suprimir el ruido de fase de la se√±al.",
      "Filtrar las componentes indeseadas en el dominio temporal."
    ],
    correctAnswer:"Mezclar la se√±al de entrada para llevarla a una frecuencia intermedia (IF) fija.",
    keywords:["oscilador local","frecuencia intermedia","IF","mezclar"]
  },
  {
    question:"Un estudiante observa que dos se√±ales muy pr√≥ximas en frecuencia aparecen como una sola en el analizador de espectro. ¬øQu√© deber√≠a ajustar?",
    options:[
      "Disminuir el RBW.",
      "Aumentar el tiempo de barrido.",
      "Reducir el atenuador de entrada.",
      "Subir la escala logar√≠tmica en pantalla."
    ],
    correctAnswer:"Disminuir el RBW.",
    keywords:["RBW","se√±ales pr√≥ximas","resoluci√≥n"]
  },
  {
    question:"¬øQu√© diferencia pr√°ctica existe entre un osciloscopio y un analizador de espectro?",
    options:[
      "El osciloscopio muestra se√±ales en el dominio del tiempo, el analizador en el dominio de la frecuencia.",
      "El analizador mide tensi√≥n y el osciloscopio potencia.",
      "Ambos trabajan en el mismo dominio pero con distinta escala.",
      "El analizador de espectro es m√°s preciso que cualquier osciloscopio."
    ],
    correctAnswer:"El osciloscopio muestra se√±ales en el dominio del tiempo, el analizador en el dominio de la frecuencia.",
    keywords:["osciloscopio","analizador","dominio tiempo","dominio frecuencia"]
  }
];

let currentQuestionIndex=0;
let userAnswers={};
let examStarted=false;
let quizFinished=false;

// 30 minutos
let timeLeft=30*60; 
let timerInterval;

const roleScreen=document.getElementById('role-screen');
const startScreen=document.getElementById('start-screen');
const professorScreen=document.getElementById('professor-screen');
const professorPanel=document.getElementById('professor-panel');
const quizScreen=document.getElementById('quiz-screen');
const resultsScreen=document.getElementById('results');
const quizContent=document.getElementById('quiz-content');
const questionCounter=document.getElementById('question-counter');
const progressBar=document.querySelector('.progress');
const nextBtn=document.getElementById('next-btn');
const scoreDisplay=document.querySelector('.score-display');
const resultsDetails=document.getElementById('results-details');

// Botones de rol
document.getElementById('btn-student').addEventListener('click', ()=>{
  roleScreen.classList.remove('active');
  startScreen.classList.add('active');
});

document.getElementById('btn-professor').addEventListener('click', ()=>{
  roleScreen.classList.remove('active');
  professorScreen.classList.add('active');
});

// Login profesor
document.getElementById('login-professor-btn').addEventListener('click', ()=>{
  const cedula=document.getElementById('prof-cedula').value.trim();
  const clave=document.getElementById('prof-clave').value.trim();
  if(!cedula || !clave){ alert("Completa todos los campos."); return; }
  if(clave!==PROFESOR_CLAVE){ alert("Clave incorrecta."); return; }
  professorScreen.classList.remove('active');
  professorPanel.classList.add('active');
  loadGrades();
});

// Solo n√∫meros en c√©dula estudiante
document.getElementById('user-cedula').addEventListener('input', e=>{ e.target.value=e.target.value.replace(/\D/g,''); });

// Inicio examen estudiante
document.getElementById('start-quiz-btn').addEventListener('click', ()=>{
  if(!document.getElementById('user-name').value.trim()||
     !document.getElementById('user-lastname').value.trim()||
     !document.getElementById('user-cedula').value.trim()||
     !document.getElementById('user-school').value){
       alert("Por favor completa todos los campos correctamente."); return;
     }
  startScreen.classList.remove('active');
  quizScreen.classList.add('active');
  examStarted=true;
  loadQuestion();
  startTimer(); 
});

function startTimer(){
  timerInterval=setInterval(()=>{
    const minutes=Math.floor(timeLeft/60);
    const seconds=timeLeft%60;
    document.getElementById('timer').textContent=
      `Tiempo: ${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
    if(timeLeft <= 0){
      clearInterval(timerInterval);
      alert("‚è∞ El tiempo ha finalizado. El examen se cerrar√° autom√°ticamente.");
      displayResults();
    }
    timeLeft--;
  },1000);
}

function loadQuestion(){
  const q=allQuizData[currentQuestionIndex];
  const saved=userAnswers[currentQuestionIndex]||{answer:"",justification:""};
  let optionsHtml="";
  q.options.forEach(opt=>{
    const sel=saved.answer===opt?"selected":"";
    optionsHtml+=`<li class="${sel}">${opt}</li>`;
  });
  quizContent.innerHTML=`
    <div class="question-box">${q.question}</div>
    <ul class="options-list">${optionsHtml}</ul>
    <div class="user-justification-container">
      <label>Tu Justificaci√≥n:</label>
      <textarea id="user-justification" placeholder="M√°x. 200 caracteres...">${saved.justification}</textarea>
      <div class="word-count" id="word-count">${saved.justification.length}/200</div>
    </div>
  `;
  questionCounter.textContent=`Pregunta ${currentQuestionIndex+1} de ${allQuizData.length}`;
  progressBar.style.width=`${(currentQuestionIndex/allQuizData.length)*100}%`;

  document.querySelectorAll('.options-list li').forEach(li=>{
    li.addEventListener('click',()=>{ document.querySelectorAll('.options-list li').forEach(l=>l.classList.remove('selected')); li.classList.add('selected'); });
  });

  document.getElementById('user-justification').addEventListener('input', e=>{
    if(e.target.value.length>200) e.target.value=e.target.value.slice(0,200);
    document.getElementById('word-count').textContent=`${e.target.value.length}/200`;
  });
}

// Siguiente
nextBtn.addEventListener('click', ()=>{
  const selected=document.querySelector('.options-list li.selected');
  const justification=document.getElementById('user-justification').value.trim();
  userAnswers[currentQuestionIndex]={ answer:selected?selected.textContent:"", justification };
  currentQuestionIndex++;
  if(currentQuestionIndex<allQuizData.length){ loadQuestion(); }
  else{ displayResults(); }
});

function displayResults(){
  quizFinished=true;
  examStarted=false;
  clearInterval(timerInterval);
  quizScreen.classList.remove('active');
  resultsScreen.classList.add('active');
  let totalScore=0;
  resultsDetails.innerHTML="";
  allQuizData.forEach((q,i)=>{
    const ua=userAnswers[i]||{answer:"",justification:""};
    let points=0;
    const answerCorrect=ua.answer===q.correctAnswer;
    let justificationCorrect=false;
    if(ua.justification){
      const lowerJust=ua.justification.toLowerCase();
      justificationCorrect=q.keywords.every(kw=>lowerJust.includes(kw.toLowerCase()));
    }
    if(answerCorrect && justificationCorrect) points=4;
    else if(answerCorrect && !justificationCorrect) points=1;
    else if(!answerCorrect && justificationCorrect) points=3;
    else points=0;
    totalScore+=points;

    let classes="result-item";
    let icon="";
    if(points===4){ classes+=" correct"; icon="‚úÖ"; }
    else if(points===1||points===3){ classes+=" partial"; icon="‚ö†Ô∏è"; }
    else { classes+=" incorrect"; icon="‚ùå"; }

    let html=`<div class="${classes}">${icon} <strong>Pregunta ${i+1}:</strong> ${q.question}<br>
      <strong>Tu respuesta:</strong> ${ua.answer||"No respondida"}<br>
      <strong>Respuesta correcta:</strong> ${q.correctAnswer}<br>`;
    if(ua.justification) html+=`<strong>Justificaci√≥n:</strong> ${ua.justification}<br>`;
    html+=`<strong>Puntos:</strong> ${points}/4</div>`;
    resultsDetails.innerHTML+=html;
  });
  scoreDisplay.textContent=`Puntuaci√≥n Total: ${totalScore}/${allQuizData.length*4}`;
  progressBar.style.width="100%";

  // Guardar nota si no existe
  saveGrade(totalScore);
}

function saveGrade(score){
  const name=document.getElementById('user-name').value.trim();
  const lastname=document.getElementById('user-lastname').value.trim();
  const cedula=document.getElementById('user-cedula').value.trim();
  const school=document.getElementById('user-school').value;
  let grades=JSON.parse(localStorage.getItem('grades')||'[]');
  if(grades.some(g=>g.cedula===cedula)) return; // ya existe
  grades.push({name,lastname,cedula,school,score});
  localStorage.setItem('grades',JSON.stringify(grades));
}

function loadGrades(){
  const tbody=document.querySelector('#grades-table tbody');
  tbody.innerHTML="";
  let grades=JSON.parse(localStorage.getItem('grades')||'[]');
  grades.forEach((g,idx)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${g.name}</td>
      <td>${g.lastname}</td>
      <td>${g.cedula}</td>
      <td>${g.school}</td>
      <td>${g.score}</td>
      <td><button onclick="deleteGrade(${idx})">‚ùå Borrar</button></td>
    `;
    tbody.appendChild(tr);
  });
}

function deleteGrade(index){
  let grades=JSON.parse(localStorage.getItem('grades')||'[]');
  grades.splice(index,1);
  localStorage.setItem('grades',JSON.stringify(grades));
  loadGrades();
}

// Finalizar examen si cambia de pesta√±a solo durante examen
document.addEventListener("visibilitychange", ()=>{
  if(examStarted && !quizFinished && document.hidden){ alert("El examen ha finalizado autom√°ticamente."); displayResults(); }
});
window.addEventListener("blur", ()=>{
  if(examStarted && !quizFinished){ alert("El examen ha finalizado autom√°ticamente."); displayResults(); }
});
</script>
</div>
</body>
</html>
